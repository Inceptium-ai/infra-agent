# TargetGroupBinding CRDs for AWS Load Balancer Controller
# These bind Kubernetes services to ALB Target Groups via IaC
# NIST SC-8: Transmission Confidentiality (via ALB HTTPS)
# NIST CM-3: Configuration Change Control (IaC managed)
#
# Requires: AWS Load Balancer Controller installed with TargetGroupBinding CRD
#
# IMPORTANT: Update targetGroupARN values after deploying CloudFormation stack
# Get ARNs: aws cloudformation describe-stacks --stack-name infra-agent-dev-alb-observability --query 'Stacks[0].Outputs'
#
# Deploy: kubectl apply -f infra/helm/values/alb-target-group-bindings.yaml
---
apiVersion: elbv2.k8s.aws/v1beta1
kind: TargetGroupBinding
metadata:
  name: signoz-tgb
  namespace: signoz
  labels:
    app: signoz
spec:
  serviceRef:
    name: signoz-alb
    port: 8080
  # UPDATE THIS ARN after CloudFormation deployment
  # Get from: aws cloudformation describe-stacks --stack-name infra-agent-dev-alb-observability \
  #           --query 'Stacks[0].Outputs[?OutputKey==`SigNozTargetGroupArn`].OutputValue' --output text
  targetGroupARN: arn:aws:elasticloadbalancing:us-east-1:340752837296:targetgroup/infra-agent-dev-signoz-tg/7d0000cfeb2bbc45
  targetType: instance
---
apiVersion: elbv2.k8s.aws/v1beta1
kind: TargetGroupBinding
metadata:
  name: headlamp-tgb
  namespace: headlamp
  labels:
    app: headlamp
spec:
  serviceRef:
    name: headlamp-alb
    port: 80
  targetGroupARN: arn:aws:elasticloadbalancing:us-east-1:340752837296:targetgroup/infra-agent-dev-headlamp-tg/bd45f0f77dfae8e7
  targetType: instance
---
apiVersion: elbv2.k8s.aws/v1beta1
kind: TargetGroupBinding
metadata:
  name: kubecost-tgb
  namespace: kubecost
  labels:
    app: kubecost
spec:
  serviceRef:
    name: kubecost-alb
    port: 80
  # UPDATE THIS ARN after CloudFormation deployment
  # Get from: aws cloudformation describe-stacks --stack-name infra-agent-dev-alb-observability \
  #           --query 'Stacks[0].Outputs[?OutputKey==`KubecostTargetGroupArn`].OutputValue' --output text
  targetGroupARN: arn:aws:elasticloadbalancing:us-east-1:340752837296:targetgroup/infra-agent-dev-kubecost-tg/fc31724bf1e79506
  targetType: instance
